{"ast":null,"code":"var _jsxFileName = \"/Users/estherchung/Desktop/pop-culture/frontend/src/App.js\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect, useState, useCallback } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction App() {\n  _s();\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const referenceVideoRef = useRef(null);\n  const referenceCanvasRef = useRef(null);\n  const poseRef = useRef(null);\n  const referencePoseRef = useRef(null);\n  const [isReferenceVideoReady, setIsReferenceVideoReady] = useState(false);\n  const [isWebcamReady, setIsWebcamReady] = useState(false);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [similarityScore, setSimilarityScore] = useState(null);\n  const [referencePoses, setReferencePoses] = useState([]);\n  const [userPoses, setUserPoses] = useState([]);\n  const [isRecording, setIsRecording] = useState(false);\n  const [countdown, setCountdown] = useState(null);\n  const [isReady, setIsReady] = useState(false);\n  const onResults = useCallback(results => {\n    if (!canvasRef.current) return;\n    const canvasElement = canvasRef.current;\n    const canvasCtx = canvasElement.getContext(\"2d\");\n\n    // Clear the canvas\n    canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);\n\n    // Draw the video frame mirrored\n    canvasCtx.save();\n    canvasCtx.scale(-1, 1);\n    canvasCtx.drawImage(results.image, -canvasElement.width, 0, canvasElement.width, canvasElement.height);\n    canvasCtx.restore();\n    if (results.poseLandmarks) {\n      // Mirror the landmarks\n      const mirroredLandmarks = results.poseLandmarks.map(landmark => ({\n        ...landmark,\n        x: 1 - landmark.x // Mirror x coordinate\n      }));\n\n      // Draw the pose landmarks\n      window.drawConnectors(canvasCtx, mirroredLandmarks, window.POSE_CONNECTIONS, {\n        color: '#00FF00',\n        lineWidth: 2\n      });\n      window.drawLandmarks(canvasCtx, mirroredLandmarks, {\n        color: '#FF0000',\n        lineWidth: 1,\n        radius: 3\n      });\n\n      // Store user poses if recording\n      if (isRecording && isPlaying) {\n        setUserPoses(prev => [...prev, mirroredLandmarks]);\n      }\n    }\n  }, [isRecording, isPlaying]);\n  const onReferenceResults = useCallback(results => {\n    if (!referenceCanvasRef.current) return;\n    const canvasElement = referenceCanvasRef.current;\n    const canvasCtx = canvasElement.getContext(\"2d\");\n\n    // Clear the canvas\n    canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);\n\n    // Draw the video frame\n    canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);\n    if (results.poseLandmarks) {\n      // Draw the pose landmarks\n      window.drawConnectors(canvasCtx, results.poseLandmarks, window.POSE_CONNECTIONS, {\n        color: '#00FF00',\n        lineWidth: 2\n      });\n      window.drawLandmarks(canvasCtx, results.poseLandmarks, {\n        color: '#FF0000',\n        lineWidth: 1,\n        radius: 3\n      });\n\n      // Store reference poses if playing\n      if (isPlaying) {\n        setReferencePoses(prev => [...prev, results.poseLandmarks]);\n      }\n    }\n  }, [isPlaying]);\n  useEffect(() => {\n    // Initialize MediaPipe Pose for user video\n    const pose = new window.Pose({\n      locateFile: file => {\n        return `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`;\n      }\n    });\n\n    // Initialize MediaPipe Pose for reference video\n    const referencePose = new window.Pose({\n      locateFile: file => {\n        return `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`;\n      }\n    });\n\n    // Set options after a small delay to ensure proper initialization\n    setTimeout(() => {\n      pose.setOptions({\n        modelComplexity: 1,\n        smoothLandmarks: true,\n        minDetectionConfidence: 0.5,\n        minTrackingConfidence: 0.5\n      });\n      referencePose.setOptions({\n        modelComplexity: 1,\n        smoothLandmarks: true,\n        minDetectionConfidence: 0.5,\n        minTrackingConfidence: 0.5\n      });\n      pose.onResults(onResults);\n      referencePose.onResults(onReferenceResults);\n      poseRef.current = pose;\n      referencePoseRef.current = referencePose;\n    }, 100);\n\n    // Access webcam\n    navigator.mediaDevices.getUserMedia({\n      video: true\n    }).then(stream => {\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n        videoRef.current.onloadedmetadata = () => {\n          videoRef.current.play().then(() => setIsWebcamReady(true)).catch(err => console.error(\"Error playing webcam:\", err));\n        };\n      }\n    }).catch(err => {\n      console.error(\"Error accessing webcam:\", err);\n    });\n    return () => {\n      // Cleanup\n      if (poseRef.current) {\n        poseRef.current.close();\n      }\n      if (referencePoseRef.current) {\n        referencePoseRef.current.close();\n      }\n    };\n  }, [onResults, onReferenceResults]);\n  const calculateMovementVector = (pose1, pose2) => {\n    if (!pose1 || !pose2) return null;\n    const vector = [];\n    for (let i = 0; i < pose1.length; i++) {\n      if (pose1[i] && pose2[i]) {\n        vector.push({\n          x: pose2[i].x - pose1[i].x,\n          y: pose2[i].y - pose1[i].y\n        });\n      }\n    }\n    return vector;\n  };\n  const calculateCosineSimilarity = (vec1, vec2) => {\n    if (!vec1 || !vec2 || vec1.length !== vec2.length) return 0;\n    let dotProduct = 0;\n    let magnitude1 = 0;\n    let magnitude2 = 0;\n    for (let i = 0; i < vec1.length; i++) {\n      if (vec1[i] && vec2[i]) {\n        dotProduct += vec1[i].x * vec2[i].x + vec1[i].y * vec2[i].y;\n        magnitude1 += vec1[i].x * vec1[i].x + vec1[i].y * vec1[i].y;\n        magnitude2 += vec2[i].x * vec2[i].x + vec2[i].y * vec2[i].y;\n      }\n    }\n    magnitude1 = Math.sqrt(magnitude1);\n    magnitude2 = Math.sqrt(magnitude2);\n    if (magnitude1 === 0 || magnitude2 === 0) return 0;\n\n    // Convert cosine similarity from [-1, 1] to [0, 1] and add 50\n    const similarity = (dotProduct / (magnitude1 * magnitude2) + 1) / 2;\n    return similarity * 50 + 50;\n  };\n  const calculateSimilarity = () => {\n    if (referencePoses.length < 2 || userPoses.length < 2) return 0;\n\n    // Calculate movement vectors for both sequences\n    const refMovementVectors = [];\n    const userMovementVectors = [];\n\n    // Calculate vectors for reference video\n    for (let i = 1; i < referencePoses.length; i++) {\n      const vector = calculateMovementVector(referencePoses[i - 1], referencePoses[i]);\n      if (vector) refMovementVectors.push(vector);\n    }\n\n    // Calculate vectors for user video\n    for (let i = 1; i < userPoses.length; i++) {\n      const vector = calculateMovementVector(userPoses[i - 1], userPoses[i]);\n      if (vector) userMovementVectors.push(vector);\n    }\n\n    // Normalize the number of vectors to compare\n    const minLength = Math.min(refMovementVectors.length, userMovementVectors.length);\n    if (minLength === 0) return 0;\n    let totalSimilarity = 0;\n    let count = 0;\n\n    // Compare corresponding movement vectors\n    for (let i = 0; i < minLength; i++) {\n      const similarity = calculateCosineSimilarity(refMovementVectors[i], userMovementVectors[i]);\n      if (!isNaN(similarity)) {\n        totalSimilarity += similarity;\n        count++;\n      }\n    }\n    return count > 0 ? totalSimilarity / count : 0;\n  };\n  const handleVideoEnd = () => {\n    setIsPlaying(false);\n    setIsRecording(false);\n    const score = calculateSimilarity();\n    setSimilarityScore(score);\n    setReferencePoses([]);\n    setUserPoses([]);\n  };\n  const startCountdown = () => {\n    setCountdown(3);\n    setIsReady(true);\n  };\n  useEffect(() => {\n    let timer;\n    if (countdown > 0) {\n      timer = setTimeout(() => {\n        setCountdown(countdown - 1);\n      }, 1000);\n    } else if (countdown === 0) {\n      // Start the video when countdown reaches 0\n      if (referenceVideoRef.current) {\n        referenceVideoRef.current.play();\n        setIsPlaying(true);\n        setIsRecording(true);\n        setSimilarityScore(null);\n        setReferencePoses([]);\n        setUserPoses([]);\n      }\n      setCountdown(null);\n    }\n    return () => {\n      if (timer) clearTimeout(timer);\n    };\n  }, [countdown]);\n  const togglePlayPause = () => {\n    if (referenceVideoRef.current) {\n      if (isPlaying) {\n        referenceVideoRef.current.pause();\n        setIsPlaying(false);\n        setIsRecording(false);\n        setIsReady(false);\n      } else {\n        startCountdown();\n      }\n    }\n  };\n  const restartVideo = () => {\n    if (referenceVideoRef.current) {\n      referenceVideoRef.current.currentTime = 0;\n      setIsPlaying(false);\n      setIsRecording(false);\n      setIsReady(false);\n      setCountdown(null);\n      // Clear all stored data\n      setSimilarityScore(null);\n      setReferencePoses([]);\n      setUserPoses([]);\n    }\n  };\n  const handleReferenceVideoLoad = () => {\n    if (referenceVideoRef.current) {\n      setIsReferenceVideoReady(true);\n    }\n  };\n  useEffect(() => {\n    let animationFrameId;\n    let lastProcessTime = 0;\n    const processInterval = 1000 / 30; // Process at 30fps\n\n    const processFrame = async timestamp => {\n      if (timestamp - lastProcessTime >= processInterval) {\n        try {\n          if (videoRef.current && poseRef.current && isWebcamReady) {\n            await poseRef.current.send({\n              image: videoRef.current\n            });\n          }\n          if (referenceVideoRef.current && referencePoseRef.current && isReferenceVideoReady && isPlaying) {\n            await referencePoseRef.current.send({\n              image: referenceVideoRef.current\n            });\n          }\n          lastProcessTime = timestamp;\n        } catch (error) {\n          console.error(\"Error processing frame:\", error);\n        }\n      }\n      animationFrameId = requestAnimationFrame(processFrame);\n    };\n    processFrame(0);\n    return () => {\n      if (animationFrameId) {\n        cancelAnimationFrame(animationFrameId);\n      }\n    };\n  }, [isWebcamReady, isReferenceVideoReady, isPlaying]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    style: {\n      textAlign: \"center\",\n      padding: \"20px\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"Dance Battle App\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 325,\n      columnNumber: 7\n    }, this), similarityScore !== null && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontSize: \"24px\",\n        margin: \"20px\",\n        padding: \"15px\",\n        backgroundColor: \"#f0f0f0\",\n        borderRadius: \"10px\",\n        display: \"inline-block\"\n      },\n      children: [\"Similarity Score: \", similarityScore.toFixed(2), \"%\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 327,\n      columnNumber: 9\n    }, this), countdown !== null && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontSize: \"72px\",\n        margin: \"20px\",\n        padding: \"15px\",\n        color: \"#4CAF50\",\n        fontWeight: \"bold\"\n      },\n      children: countdown\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 339,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: \"flex\",\n        justifyContent: \"center\",\n        gap: \"40px\",\n        flexWrap: \"wrap\",\n        maxWidth: \"1400px\",\n        margin: \"0 auto\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: \"relative\",\n          width: \"640px\",\n          marginBottom: \"20px\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Reference Dance\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 363,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            position: \"relative\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"video\", {\n            ref: referenceVideoRef,\n            src: \"/justdance1.mp4\",\n            playsInline: true,\n            onLoadedMetadata: handleReferenceVideoLoad,\n            onEnded: handleVideoEnd,\n            style: {\n              width: \"100%\",\n              height: \"auto\",\n              borderRadius: \"12px\",\n              boxShadow: \"0 0 10px rgba(0,0,0,0.3)\",\n              display: \"block\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 365,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n            ref: referenceCanvasRef,\n            width: \"640\",\n            height: \"480\",\n            style: {\n              position: \"absolute\",\n              top: 0,\n              left: 0,\n              width: \"100%\",\n              height: \"100%\",\n              borderRadius: \"12px\",\n              boxShadow: \"0 0 10px rgba(0,0,0,0.3)\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 379,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              position: \"absolute\",\n              bottom: \"20px\",\n              left: \"50%\",\n              transform: \"translateX(-50%)\",\n              display: \"flex\",\n              gap: \"10px\",\n              zIndex: 10\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: togglePlayPause,\n              style: {\n                padding: \"8px 16px\",\n                borderRadius: \"20px\",\n                border: \"none\",\n                backgroundColor: isReady ? \"#FF5722\" : \"#4CAF50\",\n                color: \"white\",\n                cursor: \"pointer\",\n                fontSize: \"16px\"\n              },\n              children: isReady ? \"Cancel\" : isPlaying ? \"Pause\" : \"Start\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 402,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: restartVideo,\n              style: {\n                padding: \"8px 16px\",\n                borderRadius: \"20px\",\n                border: \"none\",\n                backgroundColor: \"#2196F3\",\n                color: \"white\",\n                cursor: \"pointer\",\n                fontSize: \"16px\"\n              },\n              children: \"Restart\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 416,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 393,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 364,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 358,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: \"relative\",\n          width: \"640px\",\n          marginBottom: \"20px\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Your Dance\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 440,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            position: \"relative\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"video\", {\n            ref: videoRef,\n            autoPlay: true,\n            playsInline: true,\n            style: {\n              width: \"100%\",\n              height: \"auto\",\n              borderRadius: \"12px\",\n              boxShadow: \"0 0 10px rgba(0,0,0,0.3)\",\n              display: \"block\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 442,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n            ref: canvasRef,\n            width: \"640\",\n            height: \"480\",\n            style: {\n              position: \"absolute\",\n              top: 0,\n              left: 0,\n              width: \"100%\",\n              height: \"100%\",\n              borderRadius: \"12px\",\n              boxShadow: \"0 0 10px rgba(0,0,0,0.3)\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 454,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 441,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 435,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 349,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 324,\n    columnNumber: 5\n  }, this);\n}\n_s(App, \"PGthPKL1wDXxsP10fb7yGQvAU2E=\");\n_c = App;\nexport default App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","useRef","useEffect","useState","useCallback","jsxDEV","_jsxDEV","App","_s","videoRef","canvasRef","referenceVideoRef","referenceCanvasRef","poseRef","referencePoseRef","isReferenceVideoReady","setIsReferenceVideoReady","isWebcamReady","setIsWebcamReady","isPlaying","setIsPlaying","similarityScore","setSimilarityScore","referencePoses","setReferencePoses","userPoses","setUserPoses","isRecording","setIsRecording","countdown","setCountdown","isReady","setIsReady","onResults","results","current","canvasElement","canvasCtx","getContext","clearRect","width","height","save","scale","drawImage","image","restore","poseLandmarks","mirroredLandmarks","map","landmark","x","window","drawConnectors","POSE_CONNECTIONS","color","lineWidth","drawLandmarks","radius","prev","onReferenceResults","pose","Pose","locateFile","file","referencePose","setTimeout","setOptions","modelComplexity","smoothLandmarks","minDetectionConfidence","minTrackingConfidence","navigator","mediaDevices","getUserMedia","video","then","stream","srcObject","onloadedmetadata","play","catch","err","console","error","close","calculateMovementVector","pose1","pose2","vector","i","length","push","y","calculateCosineSimilarity","vec1","vec2","dotProduct","magnitude1","magnitude2","Math","sqrt","similarity","calculateSimilarity","refMovementVectors","userMovementVectors","minLength","min","totalSimilarity","count","isNaN","handleVideoEnd","score","startCountdown","timer","clearTimeout","togglePlayPause","pause","restartVideo","currentTime","handleReferenceVideoLoad","animationFrameId","lastProcessTime","processInterval","processFrame","timestamp","send","requestAnimationFrame","cancelAnimationFrame","className","style","textAlign","padding","children","fileName","_jsxFileName","lineNumber","columnNumber","fontSize","margin","backgroundColor","borderRadius","display","toFixed","fontWeight","justifyContent","gap","flexWrap","maxWidth","position","marginBottom","ref","src","playsInline","onLoadedMetadata","onEnded","boxShadow","top","left","bottom","transform","zIndex","onClick","border","cursor","autoPlay","_c","$RefreshReg$"],"sources":["/Users/estherchung/Desktop/pop-culture/frontend/src/App.js"],"sourcesContent":["import React, { useRef, useEffect, useState, useCallback } from \"react\";\n\nfunction App() {\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const referenceVideoRef = useRef(null);\n  const referenceCanvasRef = useRef(null);\n  const poseRef = useRef(null);\n  const referencePoseRef = useRef(null);\n  const [isReferenceVideoReady, setIsReferenceVideoReady] = useState(false);\n  const [isWebcamReady, setIsWebcamReady] = useState(false);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [similarityScore, setSimilarityScore] = useState(null);\n  const [referencePoses, setReferencePoses] = useState([]);\n  const [userPoses, setUserPoses] = useState([]);\n  const [isRecording, setIsRecording] = useState(false);\n  const [countdown, setCountdown] = useState(null);\n  const [isReady, setIsReady] = useState(false);\n\n  const onResults = useCallback((results) => {\n    if (!canvasRef.current) return;\n    \n    const canvasElement = canvasRef.current;\n    const canvasCtx = canvasElement.getContext(\"2d\");\n\n    // Clear the canvas\n    canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);\n\n    // Draw the video frame mirrored\n    canvasCtx.save();\n    canvasCtx.scale(-1, 1);\n    canvasCtx.drawImage(results.image, -canvasElement.width, 0, canvasElement.width, canvasElement.height);\n    canvasCtx.restore();\n\n    if (results.poseLandmarks) {\n      // Mirror the landmarks\n      const mirroredLandmarks = results.poseLandmarks.map(landmark => ({\n        ...landmark,\n        x: 1 - landmark.x // Mirror x coordinate\n      }));\n\n      // Draw the pose landmarks\n      window.drawConnectors(canvasCtx, mirroredLandmarks, window.POSE_CONNECTIONS,\n        { color: '#00FF00', lineWidth: 2 });\n      window.drawLandmarks(canvasCtx, mirroredLandmarks,\n        { color: '#FF0000', lineWidth: 1, radius: 3 });\n\n      // Store user poses if recording\n      if (isRecording && isPlaying) {\n        setUserPoses(prev => [...prev, mirroredLandmarks]);\n      }\n    }\n  }, [isRecording, isPlaying]);\n\n  const onReferenceResults = useCallback((results) => {\n    if (!referenceCanvasRef.current) return;\n    \n    const canvasElement = referenceCanvasRef.current;\n    const canvasCtx = canvasElement.getContext(\"2d\");\n\n    // Clear the canvas\n    canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);\n\n    // Draw the video frame\n    canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);\n\n    if (results.poseLandmarks) {\n      // Draw the pose landmarks\n      window.drawConnectors(canvasCtx, results.poseLandmarks, window.POSE_CONNECTIONS,\n        { color: '#00FF00', lineWidth: 2 });\n      window.drawLandmarks(canvasCtx, results.poseLandmarks,\n        { color: '#FF0000', lineWidth: 1, radius: 3 });\n\n      // Store reference poses if playing\n      if (isPlaying) {\n        setReferencePoses(prev => [...prev, results.poseLandmarks]);\n      }\n    }\n  }, [isPlaying]);\n\n  useEffect(() => {\n    // Initialize MediaPipe Pose for user video\n    const pose = new window.Pose({\n      locateFile: (file) => {\n        return `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`;\n      }\n    });\n\n    // Initialize MediaPipe Pose for reference video\n    const referencePose = new window.Pose({\n      locateFile: (file) => {\n        return `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`;\n      }\n    });\n\n    // Set options after a small delay to ensure proper initialization\n    setTimeout(() => {\n      pose.setOptions({\n        modelComplexity: 1,\n        smoothLandmarks: true,\n        minDetectionConfidence: 0.5,\n        minTrackingConfidence: 0.5\n      });\n\n      referencePose.setOptions({\n        modelComplexity: 1,\n        smoothLandmarks: true,\n        minDetectionConfidence: 0.5,\n        minTrackingConfidence: 0.5\n      });\n\n      pose.onResults(onResults);\n      referencePose.onResults(onReferenceResults);\n      poseRef.current = pose;\n      referencePoseRef.current = referencePose;\n    }, 100);\n\n    // Access webcam\n    navigator.mediaDevices.getUserMedia({ video: true })\n      .then((stream) => {\n        if (videoRef.current) {\n          videoRef.current.srcObject = stream;\n          videoRef.current.onloadedmetadata = () => {\n            videoRef.current.play()\n              .then(() => setIsWebcamReady(true))\n              .catch(err => console.error(\"Error playing webcam:\", err));\n          };\n        }\n      })\n      .catch((err) => {\n        console.error(\"Error accessing webcam:\", err);\n      });\n\n    return () => {\n      // Cleanup\n      if (poseRef.current) {\n        poseRef.current.close();\n      }\n      if (referencePoseRef.current) {\n        referencePoseRef.current.close();\n      }\n    };\n  }, [onResults, onReferenceResults]);\n\n  const calculateMovementVector = (pose1, pose2) => {\n    if (!pose1 || !pose2) return null;\n    \n    const vector = [];\n    for (let i = 0; i < pose1.length; i++) {\n      if (pose1[i] && pose2[i]) {\n        vector.push({\n          x: pose2[i].x - pose1[i].x,\n          y: pose2[i].y - pose1[i].y\n        });\n      }\n    }\n    return vector;\n  };\n\n  const calculateCosineSimilarity = (vec1, vec2) => {\n    if (!vec1 || !vec2 || vec1.length !== vec2.length) return 0;\n\n    let dotProduct = 0;\n    let magnitude1 = 0;\n    let magnitude2 = 0;\n\n    for (let i = 0; i < vec1.length; i++) {\n      if (vec1[i] && vec2[i]) {\n        dotProduct += vec1[i].x * vec2[i].x + vec1[i].y * vec2[i].y;\n        magnitude1 += vec1[i].x * vec1[i].x + vec1[i].y * vec1[i].y;\n        magnitude2 += vec2[i].x * vec2[i].x + vec2[i].y * vec2[i].y;\n      }\n    }\n\n    magnitude1 = Math.sqrt(magnitude1);\n    magnitude2 = Math.sqrt(magnitude2);\n\n    if (magnitude1 === 0 || magnitude2 === 0) return 0;\n    \n    // Convert cosine similarity from [-1, 1] to [0, 1] and add 50\n    const similarity = (dotProduct / (magnitude1 * magnitude2) + 1) / 2;\n    return (similarity * 50) + 50;\n  };\n\n  const calculateSimilarity = () => {\n    if (referencePoses.length < 2 || userPoses.length < 2) return 0;\n\n    // Calculate movement vectors for both sequences\n    const refMovementVectors = [];\n    const userMovementVectors = [];\n\n    // Calculate vectors for reference video\n    for (let i = 1; i < referencePoses.length; i++) {\n      const vector = calculateMovementVector(referencePoses[i-1], referencePoses[i]);\n      if (vector) refMovementVectors.push(vector);\n    }\n\n    // Calculate vectors for user video\n    for (let i = 1; i < userPoses.length; i++) {\n      const vector = calculateMovementVector(userPoses[i-1], userPoses[i]);\n      if (vector) userMovementVectors.push(vector);\n    }\n\n    // Normalize the number of vectors to compare\n    const minLength = Math.min(refMovementVectors.length, userMovementVectors.length);\n    if (minLength === 0) return 0;\n\n    let totalSimilarity = 0;\n    let count = 0;\n\n    // Compare corresponding movement vectors\n    for (let i = 0; i < minLength; i++) {\n      const similarity = calculateCosineSimilarity(refMovementVectors[i], userMovementVectors[i]);\n      if (!isNaN(similarity)) {\n        totalSimilarity += similarity;\n        count++;\n      }\n    }\n\n    return count > 0 ? (totalSimilarity / count) : 0;\n  };\n\n  const handleVideoEnd = () => {\n    setIsPlaying(false);\n    setIsRecording(false);\n    const score = calculateSimilarity();\n    setSimilarityScore(score);\n    setReferencePoses([]);\n    setUserPoses([]);\n  };\n\n  const startCountdown = () => {\n    setCountdown(3);\n    setIsReady(true);\n  };\n\n  useEffect(() => {\n    let timer;\n    if (countdown > 0) {\n      timer = setTimeout(() => {\n        setCountdown(countdown - 1);\n      }, 1000);\n    } else if (countdown === 0) {\n      // Start the video when countdown reaches 0\n      if (referenceVideoRef.current) {\n        referenceVideoRef.current.play();\n        setIsPlaying(true);\n        setIsRecording(true);\n        setSimilarityScore(null);\n        setReferencePoses([]);\n        setUserPoses([]);\n      }\n      setCountdown(null);\n    }\n    return () => {\n      if (timer) clearTimeout(timer);\n    };\n  }, [countdown]);\n\n  const togglePlayPause = () => {\n    if (referenceVideoRef.current) {\n      if (isPlaying) {\n        referenceVideoRef.current.pause();\n        setIsPlaying(false);\n        setIsRecording(false);\n        setIsReady(false);\n      } else {\n        startCountdown();\n      }\n    }\n  };\n\n  const restartVideo = () => {\n    if (referenceVideoRef.current) {\n      referenceVideoRef.current.currentTime = 0;\n      setIsPlaying(false);\n      setIsRecording(false);\n      setIsReady(false);\n      setCountdown(null);\n      // Clear all stored data\n      setSimilarityScore(null);\n      setReferencePoses([]);\n      setUserPoses([]);\n    }\n  };\n\n  const handleReferenceVideoLoad = () => {\n    if (referenceVideoRef.current) {\n      setIsReferenceVideoReady(true);\n    }\n  };\n\n  useEffect(() => {\n    let animationFrameId;\n    let lastProcessTime = 0;\n    const processInterval = 1000 / 30; // Process at 30fps\n\n    const processFrame = async (timestamp) => {\n      if (timestamp - lastProcessTime >= processInterval) {\n        try {\n          if (videoRef.current && poseRef.current && isWebcamReady) {\n            await poseRef.current.send({ image: videoRef.current });\n          }\n          if (referenceVideoRef.current && referencePoseRef.current && isReferenceVideoReady && isPlaying) {\n            await referencePoseRef.current.send({ image: referenceVideoRef.current });\n          }\n          lastProcessTime = timestamp;\n        } catch (error) {\n          console.error(\"Error processing frame:\", error);\n        }\n      }\n      animationFrameId = requestAnimationFrame(processFrame);\n    };\n\n    processFrame(0);\n    return () => {\n      if (animationFrameId) {\n        cancelAnimationFrame(animationFrameId);\n      }\n    };\n  }, [isWebcamReady, isReferenceVideoReady, isPlaying]);\n\n  return (\n    <div className=\"App\" style={{ textAlign: \"center\", padding: \"20px\" }}>\n      <h1>Dance Battle App</h1>\n      {similarityScore !== null && (\n        <div style={{\n          fontSize: \"24px\",\n          margin: \"20px\",\n          padding: \"15px\",\n          backgroundColor: \"#f0f0f0\",\n          borderRadius: \"10px\",\n          display: \"inline-block\"\n        }}>\n          Similarity Score: {similarityScore.toFixed(2)}%\n        </div>\n      )}\n      {countdown !== null && (\n        <div style={{\n          fontSize: \"72px\",\n          margin: \"20px\",\n          padding: \"15px\",\n          color: \"#4CAF50\",\n          fontWeight: \"bold\"\n        }}>\n          {countdown}\n        </div>\n      )}\n      <div style={{ \n        display: \"flex\", \n        justifyContent: \"center\", \n        gap: \"40px\",\n        flexWrap: \"wrap\",\n        maxWidth: \"1400px\",\n        margin: \"0 auto\"\n      }}>\n        {/* Reference video container */}\n        <div style={{ \n          position: \"relative\",\n          width: \"640px\",\n          marginBottom: \"20px\"\n        }}>\n          <h3>Reference Dance</h3>\n          <div style={{ position: \"relative\" }}>\n            <video\n              ref={referenceVideoRef}\n              src=\"/justdance1.mp4\"\n              playsInline\n              onLoadedMetadata={handleReferenceVideoLoad}\n              onEnded={handleVideoEnd}\n              style={{ \n                width: \"100%\",\n                height: \"auto\",\n                borderRadius: \"12px\",\n                boxShadow: \"0 0 10px rgba(0,0,0,0.3)\",\n                display: \"block\"\n              }}\n            />\n            <canvas\n              ref={referenceCanvasRef}\n              width=\"640\"\n              height=\"480\"\n              style={{\n                position: \"absolute\",\n                top: 0,\n                left: 0,\n                width: \"100%\",\n                height: \"100%\",\n                borderRadius: \"12px\",\n                boxShadow: \"0 0 10px rgba(0,0,0,0.3)\"\n              }}\n            />\n            <div style={{\n              position: \"absolute\",\n              bottom: \"20px\",\n              left: \"50%\",\n              transform: \"translateX(-50%)\",\n              display: \"flex\",\n              gap: \"10px\",\n              zIndex: 10\n            }}>\n              <button\n                onClick={togglePlayPause}\n                style={{\n                  padding: \"8px 16px\",\n                  borderRadius: \"20px\",\n                  border: \"none\",\n                  backgroundColor: isReady ? \"#FF5722\" : \"#4CAF50\",\n                  color: \"white\",\n                  cursor: \"pointer\",\n                  fontSize: \"16px\"\n                }}\n              >\n                {isReady ? \"Cancel\" : (isPlaying ? \"Pause\" : \"Start\")}\n              </button>\n              <button\n                onClick={restartVideo}\n                style={{\n                  padding: \"8px 16px\",\n                  borderRadius: \"20px\",\n                  border: \"none\",\n                  backgroundColor: \"#2196F3\",\n                  color: \"white\",\n                  cursor: \"pointer\",\n                  fontSize: \"16px\"\n                }}\n              >\n                Restart\n              </button>\n            </div>\n          </div>\n        </div>\n\n        {/* User's video container */}\n        <div style={{ \n          position: \"relative\",\n          width: \"640px\",\n          marginBottom: \"20px\"\n        }}>\n          <h3>Your Dance</h3>\n          <div style={{ position: \"relative\" }}>\n            <video\n              ref={videoRef}\n              autoPlay\n              playsInline\n              style={{ \n                width: \"100%\",\n                height: \"auto\",\n                borderRadius: \"12px\",\n                boxShadow: \"0 0 10px rgba(0,0,0,0.3)\",\n                display: \"block\"\n              }}\n            />\n            <canvas\n              ref={canvasRef}\n              width=\"640\"\n              height=\"480\"\n              style={{\n                position: \"absolute\",\n                top: 0,\n                left: 0,\n                width: \"100%\",\n                height: \"100%\",\n                borderRadius: \"12px\",\n                boxShadow: \"0 0 10px rgba(0,0,0,0.3)\"\n              }}\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}